<%= render './partials/header' %>

<div class="container bg-white rounded shadow-sm py-3">
	<section class="content-header text-center">
		<h1>
			Este es tu detalle de pago.
		</h1>
		<h2>
			Muchas gracias por preferirnos
		</h2>
			<div><%= current_user.nickname if user_signed_in?  %></div>
			<div class="active">Detalle de tu pago:</div>
	</section>
	<div class="mt-3">
		<div class="row table-responsive">
		<% data = @payment.webpay_data.gsub('[','').gsub(']','').gsub('"','').split(',') %>
		<table class="table table-striped ">
			<tbody>
				<tr>
						<td>Número de pago</td>
						<td><%= @payment.id %></td>
				</tr>
				<tr>
						<td>Monto</td>
						<td><%= number_to_currency(@payment.amount, precision: 0, unit: "$ ", delimiter: ".")%></td>           
					</tr>
				<tr>
					<td>Bits</td>
					<% case @payment.bits %>
					<% when 'light' %>
						<td class="text-danger bold">Plan <%= @payment.bits.capitalize %> 10bits</td>           
					<% when 'medium' %>
						<td class="text-danger bold">Plan <%= @payment.bits.capitalize %> 30bits</td>           
					<% when 'large' %>
						<td class="text-danger bold">Plan <%= @payment.bits.capitalize %> 65bits</td>           
					<% when 'xlarge' %>
						<td class="text-danger bold">Plan <%= @payment.bits.capitalize %> 110bits</td>           
					<% end %>
					</tr>
				<tr>
						<td>Código de autorización de transbank</td>
						<td><%= data[4] %></td>       
				</tr>
				<tr>
						<td>Fecha de transacción</td>
						<% year = data[7].split('T')[0].to_s.split('-')[0].to_i%>
						<% month = data[7].split('T')[0].to_s.split('-')[1].to_i%>
						<% day = data[7].split('T')[0].to_s.split('-')[2].to_i%>
						<td>
							<%unless data[7].nil?%>  
								<%=format_date(Time.new(year, month, day, 0, 0, 0))%>
							<% end %></td>
				</tr>
				<tr>
						<td>Tipo de pago</td>
						<td>
							<%= 'Débito' if data[5].to_s.strip == 'VD' %>    
							<%= 'Crédito' if data[5].to_s.strip != 'VD' %>    
						</td>       
				</tr>            
				<tr>       
						<td>Tipo de cuota</td>
						<td>
							<%= 'Venta Débito' if data[5].to_s.strip == 'VD' %>
							<%= 'Sin Cuotas' if data[5].to_s.strip == 'VN' %>
							<%= 'Cuotas normales' if data[5].to_s.strip == 'VC' %>
							<%= 'Sin interés' if data[5].to_s.strip == 'SI' %>
							<%= 'Sin interés' if data[5].to_s.strip == 'S2' %>
							<%= 'Sin interés' if data[5].to_s.strip == 'NC' %>
						</td>  
				</tr>
				<% if data[10]!= " " %>
						<tr>
							<td>Número de cuotas</td>
							<td><%= data[10] %></td>          
						</tr>            
				<% end %>
				<tr>
						<td>Número de tarjeta (últimos 4 digitos)</td>
						<td><%= data[2] %></td>
				</tr>   
			</tbody>
		</table>         
		</div>
	</div>
	<div class="row">
		<%= link_to 'Vuelve al home', :root, class:'btn btn-primary' %>
	</div>
</div>
